---
title: 'Refactor infrastruttura di base e pianificazione del lavoro'
description: 'Aggiornamento di Saleor core alla 3.22.3 e reset dello storefront con relativa pulizia della macchina per preparare lo sviluppo del sistema di pagamento (Stripe)'
date: 2025-10-27
tags: ['cosmetico', 'log di sviluppo', 'infrastruttura', 'saleor', 'stripe']
authors: ['vitoesposito']
---

# Refactor degli script e dei secrets

## Situazione precedente

Fino a oggi, i secrets venivano creati tramite file `.sh` eseguiti da due script principali nella root del progetto:

```
├── saleor/
├── storefront/
├── cleanup.sh (pulizia/teardown di configurazioni o secrets)
├── setup.conf (prodotto da setup.sh, utilizzato per le variabili d'ambiente comuni)
└── setup.sh (inizializzazione e creazione dei secrets principali)
```

Il `setup.sh` fungeva da orchestratore che eseguiva gli script specifici per ogni servizio nella directory `{service}/scripts/setup.sh`. Questi script contenevano il codice per la creazione dei file `.env` specifici per ogni servizio, ma con molti elementi in comune che causavano problemi di gestione e sicurezza.

## Soluzione implementata

Ho refactorizzato gli script e i secrets per semplificare la gestione e migliorare la sicurezza dell'infrastruttura. La nuova struttura centralizza l'input tramite lo script principale, che poi genera i file `.env` specifici per ogni servizio utilizzando valori comuni.

### Unificazione della directory /services

Ho unificato la directory `/services` (che conteneva principalmente MinIO) all'interno di `/saleor`, ottimizzando gli script `.sh` per una gestione più efficiente.

## Refactor dello storefront

Lo storefront di Saleor è stato resettato dopo un'analisi delle priorità: sviluppare una struttura base dello store senza un'infrastruttura completa e funzionante sarebbe stato un investimento di tempo e risorse non giustificato.

# Gestione VPS e aaPanel

## Tentativo di implementazione aaPanel

Ho tentato di installare aaPanel per gestire le risorse della VPS, ma questo ha causato:
- Rallentamento significativo delle prestazioni
- Problemi di gestione nel reverse proxy
- Complessità aggiuntiva non necessaria

## Soluzione finale

Ho preferito mantenere una configurazione più semplice a livello macchina:
- Nginx configurato manualmente
- Container Docker per i vari servizi
- Gestione diretta senza pannelli di controllo

Questa scelta garantisce prestazioni migliori e un controllo più granulare sull'infrastruttura.

## Pianificazione del lavoro

Nei prossimi giorni, il lavoro sarà organizzato secondo le seguenti priorità:

| Priorità | Attività                                                                                                              |
|----------|----------------------------------------------------------------------------------------------------------------------|
| 1        | Integrazione sistema di pagamento (Stripe): implementare e testare il flusso di pagamento con Stripe.                  |
| 2        | Creazione database articoli selezionati: strutturare e popolare il database degli articoli selezionati per lo store. |
| 3        | Strutturazione di categorie e tag: definire e organizzare la gerarchia delle categorie e i tag dei prodotti per una migliore navigazione. |