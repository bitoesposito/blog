---
import ProjectCard from '@/components/ProjectCard.astro'
import Breadcrumbs from '@/components/Breadcrumbs.astro'
import PageHead from '@/components/PageHead.astro'
import Layout from '@/layouts/Layout.astro'
import { getAllProjects } from '@/lib/data-utils'

// Recupera tutti i progetti dalla collection e li ordina per data di inizio
const projects = await getAllProjects()
---

<Layout class="max-w-3xl">
  <PageHead slot="head" title="Progetti" />
  <Breadcrumbs items={[{ label: 'Progetti', icon: 'lucide:briefcase' }]} />
  {
    projects.length > 0 ? (
      <ul class="flex flex-col" aria-label="Lista dei progetti">
        {projects.map((project, index) => {
          const isFirst = index === 0
          const isLast = index === projects.length - 1
          const cardClass = `${isFirst ? 'rounded-tl-xl rounded-tr-xl' : 'rounded-t-none'} ${isLast ? 'rounded-bl-xl rounded-br-xl' : 'rounded-b-none'} ${!isFirst ? 'border-t-0 -mt-[1px]' : ''}`
          return (
            <li>
              <ProjectCard project={project} cardClass={cardClass} />
            </li>
          )
        })}
      </ul>
    ) : (
      <p class="text-muted-foreground text-center">Nessun progetto trovato.</p>
    )
  }
</Layout>
