---
import PostPageContent from '@/components/PostPageContent.astro'
import {
  getAdjacentEducation,
  getAllEducationAndSubposts,
  getEducationCombinedReadingTime,
  getEducationParentId,
  getEducationParentPost,
  getEducationReadingTime,
  getEducationSubpostCount,
  getEducationTOCSections,
  hasEducationSubposts,
  isEducationSubpost,
  parseAuthors,
} from '@/lib/collections'
import { render } from 'astro:content'

export async function getStaticPaths() {
  const posts = await getAllEducationAndSubposts()
  return posts.map((post) => ({
    params: { id: post.id },
    props: post,
  }))
}

const post = Astro.props
const currentPostId = Astro.params.id
const { Content, headings } = await render(post)
const authors = await parseAuthors(post.data.authors ?? [])

const isCurrentSubpost = isEducationSubpost(currentPostId)
const navigation = await getAdjacentEducation(currentPostId)
const parentPost = isCurrentSubpost ? await getEducationParentPost(currentPostId) : null

const hasChildPosts = await hasEducationSubposts(currentPostId)
const subpostCount = !isCurrentSubpost
  ? await getEducationSubpostCount(currentPostId)
  : 0
const postReadingTime = await getEducationReadingTime(currentPostId)
const combinedReadingTime =
  hasChildPosts && !isCurrentSubpost
    ? await getEducationCombinedReadingTime(currentPostId)
    : null

const tocSections = await getEducationTOCSections(currentPostId)
---

<PostPageContent
  post={post}
  collection="education"
  basePath="/education"
  currentPostId={currentPostId}
  Content={Content}
  headings={headings}
  authors={authors}
  isCurrentSubpost={isCurrentSubpost}
  parentPost={parentPost}
  hasChildPosts={hasChildPosts}
  subpostCount={subpostCount}
  postReadingTime={postReadingTime}
  combinedReadingTime={combinedReadingTime}
  tocSections={tocSections}
  navigation={navigation}
  getParentId={getEducationParentId}
/>
